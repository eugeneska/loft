
ИНСТРУКЦИЯ ПО РЕДАКТИРОВАНИЮ ЗАЛОВ И ID УСЛУГ В ПРОЕКТЕ


1. КАК РЕДАКТИРОВАТЬ ЗАЛЫ В КОДЕ


Залы хранятся в базе данных и управляются через API. Существует несколько 
мест, где залы могут быть определены или использованы:

1.1. БАЗА ДАННЫХ (таблица halls)
---------------------------------
Залы хранятся в таблице `halls` со следующими полями:
- id - уникальный идентификатор
- code - код зала (например, 'armaloft', 'merkuri', 'rufer')
- name - название зала
- capacity - вместимость
- is_active - активен ли зал (1/0)
- sort_order - порядок сортировки
- created_at - дата создания
- updated_at - дата обновления

РЕДАКТИРОВАНИЕ ЧЕРЕЗ API:
- GET /api/routes/halls.php - получить все залы
- GET /api/routes/halls.php?id=X - получить зал по ID
- POST /api/routes/halls.php - создать новый зал
- PUT /api/routes/halls.php?id=X - обновить зал
- DELETE /api/routes/halls.php?id=X - удалить зал

1.2. МАППИНГ ЗАЛОВ В YCLIENTS (booking.php)

Файл: /api/routes/booking.php
Строки: 128-136

В функции createYClientsBooking() определен маппинг залов на staff_id в YClients:

    $hallYClientsMapping = [
        'armaloft' => '267195',
        'mercury' => '3414531',
        'merkuri' => '3414531',
        'airplane' => '3610778',
        'samolet' => '3610778',
        'rufer' => '3295198',
        'pulka' => '3295199'
    ];

КАК ДОБАВИТЬ ИЛИ ИЗМЕНИТЬ ЗАЛ:
1. Откройте файл /api/routes/booking.php
2. Найдите массив $hallYClientsMapping (строка 128)
3. Добавьте или измените запись в формате:
   'код_зала' => 'staff_id_в_yclients'
4. Код зала должен соответствовать коду в базе данных (поле code в таблице halls)

ВАЖНО:
- Ключи массива (коды залов) должны быть в нижнем регистре
- staff_id берется из настроек YClients для каждого зала
- Код зала должен совпадать с тем, что используется при создании бронирования

1.3. МАППИНГ ЗАЛОВ ВО ФРОНТЕНДЕ (HTML файлы)

Некоторые залы также определены в HTML файлах (index.html, armaloft.html и др.):
- index.html, строка ~2923
- armaloft.html, merkuri.html, samolet.html, rufer.html, pulka.html

В этих файлах определен объект hallYClientsMapping в JavaScript для фронтенда.
Если вы изменяете залы в booking.php, также обновите соответствующие HTML файлы.

1.4. ЦЕНЫ НА ЗАЛЫ (таблица hall_prices)

Цены на залы хранятся в таблице hall_prices, которая связана с таблицей halls
через поле hall_id.

Для управления ценами используйте API:
- /api/routes/hallPrices.php

1.5. ПОРЯДОК РЕДАКТИРОВАНИЯ ЗАЛА

1. Определите, что нужно изменить:
   - Название зала: измените через API halls.php или напрямую в БД
   - Код зала: обновите в БД и во всех маппингах
   - Добавление нового зала:
     a) Добавьте запись в БД через API halls.php
     b) Добавьте запись в $hallYClientsMapping в booking.php
     c) Добавьте запись в $hallServiceMapping в booking.php (см. раздел 2)
     d) При необходимости добавьте цены через hallPrices.php
     e) Обновите HTML файлы, если зал должен отображаться на фронтенде

2. КАК ИЗМЕНИТЬ ID УСЛУГИ В /api/routes/booking.php


ID услуги используется для создания бронирования в YClients API.

2.1. МЕСТОПОЛОЖЕНИЕ

Файл: /api/routes/booking.php
Строки: 138-151

2.2. МАППИНГ УСЛУГ ПО ЗАЛАМ

В функции createYClientsBooking() определен маппинг залов на service_id:

    $hallServiceMapping = [
        'armaloft' => '25829928', // ID услуги для бронирования зала
        'mercury' => '25829928',
        'merkuri' => '25829928',
        'airplane' => '25829928',
        'samolet' => '25829928',
        'rufer' => '25829928',
        'pulka' => '25829928'
    ];
    
    // Дефолтный service_id, если не найден в маппинге
    $defaultServiceId = '25829928'; // ID услуги для бронирования зала

2.3. КАК ИЗМЕНИТЬ ID УСЛУГИ


ВАРИАНТ 1: Изменить для всех залов
1. Откройте файл /api/routes/booking.php
2. Найдите массив $hallServiceMapping (строка 140)
3. Найдите переменную $defaultServiceId (строка 151)
4. Замените значение '25829928' на новый ID услуги во всех местах

ВАРИАНТ 2: Изменить для конкретного зала
1. Откройте файл /api/routes/booking.php
2. Найдите массив $hallServiceMapping (строка 140)
3. Найдите нужный зал (например, 'armaloft')
4. Замените значение после стрелки на новый ID услуги:
   'armaloft' => 'НОВЫЙ_ID_УСЛУГИ',

ВАРИАНТ 3: Добавить новый зал с другой услугой
1. Откройте файл /api/routes/booking.php
2. Найдите массив $hallServiceMapping (строка 140)
3. Добавьте новую строку в конец массива:
   'код_зала' => 'ID_УСЛУГИ',
4. Не забудьте запятую после последней записи!

2.4. ГДЕ ИСПОЛЬЗУЕТСЯ SERVICE_ID

Service ID используется в следующих местах в booking.php:
- Строка 180: получение service_id для текущего зала
- Строка 263: передача в запрос к YClients API в массиве appointments:
    'services' => [(int)$serviceId],

2.5. ВАЖНЫЕ ЗАМЕЧАНИЯ

- Service ID должен быть числовым (строковое представление числа)
- ID услуги берется из настроек YClients для вашей компании
- Если service_id не найден в маппинге, используется $defaultServiceId
- После изменения кода перезапустите сервер или очистите кеш (если используется)

2.6. ПРИМЕР ИЗМЕНЕНИЯ

Пример: изменить ID услуги для зала 'armaloft' на '12345678'

БЫЛО:
    $hallServiceMapping = [
        'armaloft' => '25829928',
        'mercury' => '25829928',
        ...
    ];

СТАЛО:
    $hallServiceMapping = [
        'armaloft' => '12345678',  // Изменено
        'mercury' => '25829928',
        ...
    ];

3. ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ


3.1. ЛОГИРОВАНИЕ

Все изменения в booking.php логируются. Для отладки проверьте логи сервера:
- Логи создания бронирования в YClients
- Логи выбора service_id и staff_id

3.2. ТЕСТОВЫЙ РЕЖИМ

В booking.php есть тестовый режим для YClients (строка 115):
    $YClients_TEST_MODE = false; // Измените на true для тестирования

При включенном тестовом режиме запросы к YClients не отправляются, только логируются.

3.3. СВЯЗАННЫЕ ФАЙЛЫ

- /api/routes/booking.php - основная логика бронирования
- /api/routes/halls.php - API управления залами
- /api/routes/hallPrices.php - API управления ценами
- /api/config/database.php - настройки подключения к БД
- HTML файлы (index.html, armaloft.html и др.) - фронтенд с маппингами


