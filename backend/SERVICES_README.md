# Инструкция по управлению услугами

## Обзор

Реализована полная система управления услугами (full-CRUD) на основе верстки `service.html`. Все услуги управляются через админ-панель и автоматически отображаются в меню "Услуги" в шапке сайта.

## Структура базы данных

### Таблица `services`
Основная таблица услуг со следующими полями:
- `id` - первичный ключ
- `slug` - символьный код для URL (уникальный)
- `is_active` - активна ли страница
- `show_in_menu` - показывать ли в меню
- `menu_sort` - порядок сортировки в меню
- SEO поля: `meta_title`, `meta_description`, `meta_keywords`
- Hero блок: `hero_background_image`, `hero_title`, `hero_subtitle`, `hero_button_text`, `hero_button_link`
- Контент: `intro_title`, `intro_text`, `intro_image`
- CTA блок: `bottom_cta_title`, `bottom_cta_text`, `bottom_cta_button_text`, `bottom_cta_button_link`

### Таблица `service_advantages`
Преимущества услуги:
- `service_id` - связь с услугой
- `title`, `text`, `icon`, `image` - данные преимущества
- `sort_order` - порядок сортировки

### Таблица `service_photos`
Фотографии услуги:
- `service_id` - связь с услугой
- `image` - путь к изображению
- `caption` - подпись
- `sort_order` - порядок сортировки

## Как использовать

### 1. Доступ к админке

1. Откройте админ-панель: `http://localhost:3000/admin`
2. Войдите с учетными данными администратора
3. Перейдите на вкладку **"Услуги"**

### 2. Создание новой услуги

1. Нажмите кнопку **"+ Создать услугу"**
2. Заполните форму на вкладках:
   - **Общее**: название, slug, статусы активности и показа в меню
   - **SEO**: мета-теги для поисковых систем
   - **Hero**: фоновое изображение, заголовок, подзаголовок, кнопка
   - **Контент**: вступление, преимущества, фотографии, нижний CTA
3. Нажмите **"Сохранить"**

**Важно:**
- `slug` должен быть уникальным и содержать только латинские буквы, цифры и дефисы
- `slug` автоматически генерируется из названия, но можно отредактировать вручную
- При загрузке изображений они сохраняются в папку `uploads/services/`

### 3. Редактирование услуги

1. В списке услуг нажмите **"Редактировать"** у нужной услуги
2. Внесите изменения
3. Нажмите **"Сохранить"**

### 4. Управление показом в меню

- **Активна** (`is_active`): если включено, страница доступна по URL `/services/{slug}`
- **Показывать в меню** (`show_in_menu`): если включено, ссылка появляется в выпадающем меню "Услуги" в шапке
- **Порядок в меню** (`menu_sort`): чем меньше число, тем выше в списке

**Поведение:**
- При создании услуги с `is_active = 1` и `show_in_menu = 1` - ссылка сразу появляется в меню
- При деактивации (`is_active = 0`) - страница становится недоступна (404) и исчезает из меню
- При снятии `show_in_menu` - ссылка исчезает из меню, но страница остается доступна по прямому URL
- При удалении услуги - страница становится недоступна и ссылка исчезает из меню

### 5. Просмотр публичной страницы

- После сохранения активной услуги, страница доступна по адресу: `/services/{slug}`
- В админке есть кнопка **"Перейти"** для быстрого перехода на страницу услуги

## API Endpoints

### Для админки:
- `GET /api/services` - список всех услуг (с фильтрацией)
- `GET /api/services/admin/:id` - получить услугу по ID
- `POST /api/services` - создать услугу
- `PUT /api/services/:id` - обновить услугу
- `DELETE /api/services/:id` - удалить услугу (soft delete)

### Для публичного сайта:
- `GET /api/services/public` - список активных услуг для меню
- `GET /api/services/:slug` - получить услугу по slug (только активные)
- `GET /services/:slug` - отобразить страницу услуги

## Динамическое меню

Меню "Услуги" в шапке сайта автоматически загружается через JavaScript (`js/services-menu.js`).

**Как это работает:**
1. При загрузке страницы скрипт запрашивает `/api/services/public`
2. Получает список активных услуг с `show_in_menu = 1`
3. Создает выпадающее меню с ссылками на услуги
4. Вставляет меню в элемент навигации "Услуги"

**Добавление скрипта на другие страницы:**
Если нужно добавить динамическое меню на другие HTML страницы, добавьте перед закрывающим тегом `</body>`:
```html
<script src="js/services-menu.js"></script>
```

## Загрузка файлов

Изображения загружаются в папку `uploads/services/` с автоматическим переименованием для избежания конфликтов.

**Поддерживаемые форматы:** JPEG, JPG, PNG, GIF, WEBP
**Максимальный размер:** 10MB

При удалении или замене изображения старое автоматически удаляется с сервера.

## Структура файлов

```
backend/
├── database.js              # Добавлены таблицы services, service_advantages, service_photos
├── routes/
│   ├── services.js         # CRUD API для услуг
│   └── servicePage.js      # Рендеринг публичной страницы услуги
└── admin/
    ├── index.html          # Добавлена вкладка "Услуги"
    └── admin.js            # Функции управления услугами

js/
└── services-menu.js       # Динамическое меню услуг

uploads/
└── services/              # Загруженные изображения услуг
```

## Примечания

1. **Slug уникальность**: При создании/редактировании проверяется уникальность slug. В случае конфликта будет показана ошибка.

2. **Soft Delete**: Удаление услуги - мягкое (soft delete). Запись помечается как удаленная (`deleted_at`), но не удаляется физически из БД.

3. **Валидация**: Обязательные поля при создании:
   - `slug`
   - `hero_title`

4. **Шаблон страницы**: Публичная страница услуги основана на `service.html` и сохраняет всю верстку и стили.

5. **Расширяемость**: Структура БД и API позволяют легко добавлять новые поля без сильного рефакторинга.

## Примеры использования

### Создание простой услуги:
1. Название: "Аренда студии"
2. Slug: "studio-rental"
3. Включить "Активна" и "Показывать в меню"
4. Загрузить фоновое изображение
5. Заполнить Hero заголовок и подзаголовок
6. Сохранить

Результат: страница доступна по `/services/studio-rental` и появляется в меню.

### Деактивация услуги:
1. Открыть услугу для редактирования
2. Снять галочку "Активна"
3. Сохранить

Результат: страница возвращает 404, ссылка исчезает из меню.

